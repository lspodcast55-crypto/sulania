<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SULANIA'S CALLS ONLY - Elite</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { 
            --gold: linear-gradient(135deg, #D4AF37 0%, #F1D27B 50%, #B8860B 100%);
            --gold-solid: #D4AF37;
            --black: #050505; 
            --gray: rgba(20, 20, 20, 0.9); 
            --glass: rgba(255, 255, 255, 0.03);
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            font-family: 'Poppins', sans-serif; 
            background: var(--black);
            color: white; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }

        #bg-canvas {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            background: radial-gradient(circle at center, #1a1a1a 0%, #050505 100%);
        }

        /* --- RESPONSIVE CONTAINERS --- */
        .auth-container {
            text-align: center; background: var(--gray); 
            padding: 30px; 
            border-radius: 30px; border: 1px solid rgba(212, 175, 55, 0.2); 
            width: 90%; 
            max-width: 400px; /* Limits size on desktop */
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.8s ease-out;
        }

        #main-content { 
            display: none; 
            width: 100%; 
            height: 100vh; 
            flex-direction: column; 
        }

        header { 
            padding: 10px; 
            text-align: center; 
            background: rgba(0, 0, 0, 0.8); 
            border-bottom: 1px solid rgba(212, 175, 55, 0.2); 
        }

        h1 { 
            background: var(--gold); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin: 0; 
            font-size: 1.2rem; 
            letter-spacing: 3px; 
            font-weight: 800; 
        }

        /* --- THE FLEX LAYOUT --- */
        .main-layout { 
            display: flex; 
            flex: 1; 
            padding: 15px; 
            gap: 15px; 
            overflow: hidden; 
            flex-direction: column; /* Default: Mobile Stack */
        }

        /* Desktop View: Side-by-Side */
        @media (min-width: 768px) {
            .main-layout { flex-direction: row; }
            h1 { font-size: 1.8rem; letter-spacing: 5px; }
            header { padding: 15px; }
        }

        .video-section { 
            flex: 1.5; 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 10px; 
        }

        @media (min-width: 768px) {
            .video-section { grid-template-columns: 1fr 1fr; gap: 20px; }
        }

        .video-wrapper { 
            position: relative; 
            border-radius: 15px; 
            overflow: hidden; 
            border: 1px solid rgba(212, 175, 55, 0.3); 
            background: #000; 
            aspect-ratio: 4/3; 
        }

        video { width: 100%; height: 100%; object-fit: cover; }
        
        .chat-section { 
            flex: 1; 
            background: var(--glass); 
            border-radius: 20px; 
            display: flex; 
            flex-direction: column; 
            border: 1px solid rgba(255,255,255,0.1); 
            max-height: 400px; /* Limit height on mobile so videos stay visible */
        }

        @media (min-width: 768px) {
            .chat-section { max-height: none; }
        }

        #chat-box { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        
        .message { padding: 10px 15px; border-radius: 15px; max-width: 85%; font-size: 0.9em; }
        .sent { background: var(--gold-solid); color: black; align-self: flex-end; }
        .received { background: rgba(255,255,255,0.1); color: white; align-self: flex-start; }

        .footer-controls { 
            padding: 10px; 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 10px; 
            background: rgba(0,0,0,0.8); 
        }

        input { 
            padding: 12px; 
            border-radius: 12px; 
            border: 1px solid rgba(255,255,255,0.1); 
            background: rgba(255,255,255,0.05); 
            color: white; 
            font-size: 16px; /* Prevents iOS zoom on focus */
        }

        .send-btn { 
            background: var(--gold-solid); 
            border: none; 
            padding: 10px 20px; 
            border-radius: 12px; 
            font-weight: bold; 
            cursor: pointer; 
        }

        .hidden { display: none !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>

    <div id="login-screen" class="auth-container">
        <h2 style="color: var(--gold-solid);">SECURE ACCESS</h2>
        <input type="password" id="pass-input" placeholder="Enter PIN" style="width: 100%; box-sizing: border-box; text-align: center; margin-bottom: 20px;">
        <button class="send-btn" onclick="checkPassword()" style="width: 100%;">Authenticate</button>
    </div>

    <div id="mode-selection" class="auth-container" style="display:none;">
        <h2 style="color: var(--gold-solid);">WELCOME</h2>
        <div style="display: flex; flex-direction: column; gap: 12px;">
            <button class="send-btn" onclick="setMode('chat')">Secure Chat</button>
            <button class="send-btn" onclick="setMode('video')">Video Call</button>
            <button class="send-btn" onclick="setMode('both')">Full Access</button>
        </div>
    </div>

    <div id="main-content">
        <header>
            <h1>SULANIA'S CALLS</h1>
            <div style="font-size: 0.7em; opacity: 0.7;">Node ID: <span id="my-id" style="color:var(--gold-solid);">...</span></div>
        </header>

        <div class="main-layout">
            <div id="v-sec" class="video-section">
                <div class="video-wrapper"><video id="local-video" autoplay muted playsinline></video></div>
                <div class="video-wrapper"><video id="remote-video" autoplay playsinline></video></div>
            </div>
            
            <div id="c-sec" class="chat-section">
                <div id="chat-box"></div>
                <div class="input-group" style="padding: 10px; display: flex; gap: 8px;">
                    <input type="text" id="msg-input" placeholder="Type..." style="flex:1;">
                    <button class="send-btn" onclick="sendMsg()">></button>
                </div>
            </div>
        </div>

        <div class="footer-controls">
            <input type="text" id="remote-id" placeholder="Partner ID" style="flex: 1; max-width: 200px;">
            <button class="send-btn" onclick="startConnection()">Link</button>
        </div>
    </div>

    <script>
        // ... (Keep your existing JS logic exactly as it was) ...
        // Note: I added 'playsinline' to video tags above - this is CRITICAL for mobile Safari/Chrome 
        // to prevent videos from jumping to full-screen automatically.

        // Standard JS Logic follows...
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function initBg() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5
                });
            }
        }
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "rgba(212, 175, 55, 0.3)";
            ctx.strokeStyle = "rgba(212, 175, 55, 0.05)";
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy;
                if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                ctx.beginPath(); ctx.arc(p.x, p.y, 1.5, 0, Math.PI * 2); ctx.fill();
            });
            requestAnimationFrame(animate);
        }
        window.addEventListener('resize', initBg);
        initBg(); animate();

        const CORRECT_PASS = "Hitesh77";
        let peer, localStream, currentConn, selectedMode;

        function checkPassword() {
            if (document.getElementById('pass-input').value === CORRECT_PASS) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('mode-selection').style.display = 'block';
            } else { alert("WRONG PIN"); }
        }

        function setMode(mode) {
            selectedMode = mode;
            document.getElementById('mode-selection').style.display = 'none';
            document.getElementById('main-content').style.display = 'flex';
            if(mode === 'chat') document.getElementById('v-sec').classList.add('hidden');
            if(mode === 'video') document.getElementById('c-sec').classList.add('hidden');
            initApp();
        }

        function initApp() {
            peer = new Peer();
            peer.on('open', id => document.getElementById('my-id').innerText = id);
            if (selectedMode !== 'chat') {
                navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                    .then(s => { localStream = s; document.getElementById('local-video').srcObject = s; })
                    .catch(err => alert("Camera access denied"));
            }
            peer.on('call', call => {
                call.answer(localStream);
                call.on('stream', s => { document.getElementById('remote-video').srcObject = s; });
            });
            peer.on('connection', conn => { currentConn = conn; setupChat(); });
        }

        function startConnection() {
            const rId = document.getElementById('remote-id').value;
            if(!rId) return;
            if(selectedMode !== 'chat') {
                const call = peer.call(rId, localStream);
                call.on('stream', s => document.getElementById('remote-video').srcObject = s);
            }
            currentConn = peer.connect(rId);
            currentConn.on('open', setupChat);
        }

        function setupChat() {
            currentConn.on('data', data => { appendMessage(data, 'received'); });
        }

        function sendMsg() {
            const msg = document.getElementById('msg-input').value;
            if(!msg || !currentConn) return;
            currentConn.send(msg);
            appendMessage(msg, 'sent');
            document.getElementById('msg-input').value = "";
        }

        function appendMessage(text, type) {
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.innerText = text;
            document.getElementById('chat-box').appendChild(div);
            const cb = document.getElementById('chat-box');
            cb.scrollTop = cb.scrollHeight;
        }
    </script>
</body>
</html>
